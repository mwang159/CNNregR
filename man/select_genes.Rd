% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/preprocess.R
\name{select_genes}
\alias{select_genes}
\title{Select Marker Genes for Deconvolution (edgeR-based)}
\usage{
select_genes(
  bulk_counts,
  sc_counts_list,
  filter_biotype = TRUE,
  gene_biotypes = c("protein_coding", "lincRNA", "processed_pseudogene"),
  organism = "hsapiens",
  gene_annotation = NULL,
  chromosomes = NULL,
  exclude_genes = c("MALAT1"),
  bulk_min_expr = 1,
  bulk_min_median_quantile = 0.1,
  bulk_max_median_quantile = 0.999,
  bulk_min_cv_quantile = 0.25,
  bulk_max_cv_quantile = 1,
  ref_min_detection = 0.2,
  ref_max_housekeeping_factor = 50,
  ref_var_quantile = 0.5
)
}
\arguments{
\item{bulk_counts}{Matrix or data.frame of bulk RNA-seq counts (samples × genes)}

\item{sc_counts_list}{Named list of scRNA-seq count matrices per cell type (cells × genes)}

\item{filter_biotype}{Logical, whether to filter by gene biotype (default: TRUE)}

\item{gene_biotypes}{Gene biotypes to include if filter_biotype=TRUE 
(default: c("protein_coding", "lincRNA", "processed_pseudogene"))}

\item{organism}{Organism name for BioMart queries if filter_biotype=TRUE
Options: "hsapiens" (default), "mmusculus", or full dataset name like "hsapiens_gene_ensembl"}

\item{gene_annotation}{Optional data.frame with gene annotations (GeneName, GeneBiotype, Chromosome).
If NULL and filter_biotype=TRUE, will query BioMart.}

\item{chromosomes}{Character vector of chromosome names to include (e.g., c("1", "2", "X")).
If NULL (default), all chromosomes are included. Only used if gene_annotation has Chromosome column.}

\item{exclude_genes}{Character vector of genes to exclude (default: MALAT1).}

\item{bulk_min_expr}{Minimum median expression in bulk (default: 1)}

\item{bulk_min_median_quantile}{Minimum quantile for bulk median expression filtering (default: 0.1)}

\item{bulk_max_median_quantile}{Maximum quantile for bulk median expression filtering (default: 0.999)}

\item{bulk_min_cv_quantile}{Minimum quantile for bulk coefficient of variation filtering (default: 0.25)}

\item{bulk_max_cv_quantile}{Maximum quantile for bulk coefficient of variation filtering (default: 1.0)}

\item{ref_min_detection}{Minimum fraction of cells expressing gene per cell type in scRNA-seq (default: 0.2)}

\item{ref_max_housekeeping_factor}{Exclude genes with scRNA-seq expression > factor × median (default: 50)}

\item{ref_var_quantile}{scRNA-seq variance quantile threshold for discrimination (default: 0.5)}
}
\value{
List with:
  \item{genes}{Character vector of selected gene names}
  \item{size_factors}{TMM size factors for bulk samples}
  \item{gene_stats}{Data.frame with gene statistics}
  \item{gene_annotation}{Data.frame with gene annotations (if queried)}
}
\description{
Selects discriminative genes suitable for cell type deconvolution using
edgeR TMM normalization and coefficient of variation filtering:
1. Optional gene biotype filtering via BioMart
2. Excludes MT and ribosomal genes
3. TMM normalization with edgeR
4. CV and expression filtering
5. Variance-based discrimination from scRNA-seq
}
\examples{
\dontrun{
# Human genes with biotype filtering
result <- select_genes(
  bulk_counts = bulk_data,
  sc_counts_list = list(Astro = astro_counts, Oligo = oligo_counts),
  filter_biotype = TRUE,
  organism = "hsapiens"
)

# Skip biotype filtering (any organism)
result <- select_genes(
  bulk_counts = bulk_data,
  sc_counts_list = sc_list,
  filter_biotype = FALSE
)

# Custom biotypes for mouse
result <- select_genes(
  bulk_counts = bulk_data,
  sc_counts_list = sc_list,
  filter_biotype = TRUE,
  gene_biotypes = c("protein_coding", "lincRNA"),
  organism = "mmusculus"
)
}
}
