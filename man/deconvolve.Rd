% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/deconvolve.R
\name{deconvolve}
\alias{deconvolve}
\title{High-Level Deconvolution Wrapper}
\usage{
deconvolve(
  bulk_counts,
  sc_counts_list,
  output_dir,
  prefix = "deconv",
  epochs = 50000,
  n_clusters = 5,
  filter_biotype = TRUE,
  gene_biotypes = c("protein_coding", "lincRNA", "processed_pseudogene"),
  organism = "hsapiens",
  gene_annotation = NULL,
  chromosomes = NULL,
  exclude_genes = c("MALAT1"),
  bulk_min_expr = 1,
  bulk_min_median_quantile = 0.1,
  bulk_max_median_quantile = 0.999,
  bulk_min_cv_quantile = 0.25,
  bulk_max_cv_quantile = 1,
  bulk_min_cv_final = 1e-04,
  ref_min_detection = 0.2,
  ref_max_housekeeping_factor = 50,
  ref_var_quantile = 0.5,
  python_path = "python",
  keep_intermediates = TRUE
)
}
\arguments{
\item{bulk_counts}{Matrix or data.frame of bulk RNA-seq counts (samples × genes)}

\item{sc_counts_list}{Named list of scRNA-seq count matrices per cell type}

\item{output_dir}{Output directory for all results}

\item{prefix}{Output file prefix (default: "deconv")}

\item{epochs}{Maximum training epochs (default: 50000)}

\item{n_clusters}{Number of k-means clusters (references) per cell type (default: 5)}

\item{filter_biotype}{Logical, whether to filter by gene biotype (default: TRUE)}

\item{gene_biotypes}{Gene biotypes to include if filter_biotype=TRUE (default: protein_coding, lincRNA, processed_pseudogene)}

\item{organism}{Organism name for BioMart (default: "hsapiens")}

\item{gene_annotation}{Optional gene annotation data.frame}

\item{chromosomes}{Character vector of chromosome names to include (default: NULL)}

\item{exclude_genes}{Character vector of genes to exclude (default: MALAT1)}

\item{bulk_min_expr}{Minimum median expression in bulk (default: 1)}

\item{bulk_min_median_quantile}{Minimum quantile for bulk median expression filtering (default: 0.1)}

\item{bulk_max_median_quantile}{Maximum quantile for bulk median expression filtering (default: 0.999)}

\item{bulk_min_cv_quantile}{Minimum quantile for bulk CV filtering (default: 0.25)}

\item{bulk_max_cv_quantile}{Maximum quantile for bulk CV filtering (default: 1.0)}

\item{bulk_min_cv_final}{Minimum CV threshold after final normalization (default: 0.0001)}

\item{ref_min_detection}{Minimum fraction of cells expressing gene per cell type (default: 0.2)}

\item{ref_max_housekeeping_factor}{Exclude genes with scRNA-seq expression > factor × median (default: 50)}

\item{ref_var_quantile}{scRNA-seq variance quantile threshold (default: 0.5)}

\item{python_path}{Path to Python with CNNreg (default: "python")}

\item{keep_intermediates}{Keep intermediate CSV files (default: TRUE)}
}
\value{
List with:
  \item{genes}{Selected marker genes}
  \item{size_factors}{TMM normalization factors}
  \item{bulk_file}{Path to bulk CSV}
  \item{ref_file}{Path to reference CSV}
  \item{proportions}{Data.frame of predicted cell proportions}
  \item{cnnreg_result}{Output from run_cnnreg()}
}
\description{
Complete workflow: preprocess data and run CNNreg deconvolution using
edgeR TMM normalization and k-means clustering
}
\examples{
\dontrun{
# Human samples with biotype filtering
result <- deconvolve(
  bulk_counts = bulk_data,
  sc_counts_list = list(Astro = astro_counts, Oligo = oligo_counts),
  output_dir = "results/",
  prefix = "deconv",
  filter_biotype = TRUE,
  organism = "hsapiens"
)
}
}
